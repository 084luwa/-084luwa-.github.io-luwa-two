<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>æŠ½å°ä¸»äººï¼ˆæŒ‰éˆ•ç‰ˆãƒ»ç©©å®šä¿®æ­£ç‰ˆï¼‰</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      display: flex;
      gap: 30px;
      padding: 30px;
    }
    .panel {
      border: 1px solid #444;
      padding: 20px;
      border-radius: 8px;
      width: 340px;
    }
    textarea, input, button {
      width: 100%;
      margin: 6px 0;
      padding: 8px;
      font-size: 15px;
    }
    button { cursor: pointer; }
    .name-btn {
      width: auto;
      margin: 4px;
      padding: 6px 10px;
    }
    .result { font-size: 20px; margin-top: 10px; }
    .small { font-size: 13px; opacity: 0.8; }
  </style>
</head>
<body>

<!-- æŠ½ç±¤å€ -->
<div class="panel">
  <h2>ğŸ¯ æŠ½å°ä¸»äºº</h2>

  <p>â‘  è¼¸å…¥å…¨éƒ¨åå–®ï¼ˆä¸€è¡Œä¸€å€‹ï¼‰</p>
  <textarea id="list" rows="6" placeholder="å°æ˜\nå°è¯\nå°ç¾"></textarea>

  <button onclick="init()">âœ… ç”¢ç”ŸæŠ½ç±¤æŒ‰éˆ•</button>

  <p>â‘¡ é»é¸ã€Œç¾åœ¨æ˜¯èª°è¦æŠ½ã€</p>
  <div id="buttons"></div>

  <div id="drawResult" class="result"></div>
  <button id="hideBtn" onclick="hideResult()" style="display:none">ğŸ™ˆ éš±è—çµæœ</button>
  <div id="remain" class="small"></div>
</div>

<!-- æŸ¥è©¢å€ -->
<div class="panel">
  <h2>ğŸ“’ æŸ¥è©¢ç´€éŒ„</h2>
  <p>è¼¸å…¥åå­—æŸ¥çœ‹ä½ æŠ½åˆ°èª°</p>
  <input id="queryName" />
  <button onclick="query()">æŸ¥è©¢</button>
  <div id="queryResult" class="result"></div>
</div>

<script>
  let allPeople = [];
  let remaining = [];
  let records = {};

  // ===== localStorage =====
  function saveData() {
    localStorage.setItem("allPeople", JSON.stringify(allPeople));
    localStorage.setItem("remaining", JSON.stringify(remaining));
    localStorage.setItem("records", JSON.stringify(records));
  }

  function loadData() {
    const ap = localStorage.getItem("allPeople");
    const rm = localStorage.getItem("remaining");
    const rc = localStorage.getItem("records");
    if (ap && rm && rc) {
      allPeople = JSON.parse(ap);
      remaining = JSON.parse(rm);
      records = JSON.parse(rc);
      renderButtons();
      updateRemain();
    }
  }

  loadData();

  // åˆå§‹åŒ–ä¸¦ç”¢ç”ŸæŒ‰éˆ•
  function init() {
    const text = document.getElementById("list").value.trim();
    if (!text) {
      alert("è«‹å…ˆè¼¸å…¥åå–®");
      return;
    }
    allPeople = text.split("\n").map(n => n.trim()).filter(n => n);
    remaining = [...allPeople];
    records = {};
    renderButtons();
    updateRemain();
    saveData();
  }

  function renderButtons() {
    const box = document.getElementById("buttons");
    box.innerHTML = "";

    allPeople.forEach(name => {
      const btn = document.createElement("button");
      btn.innerText = name;
      btn.className = "name-btn";
      btn.disabled = !!records[name]; // æŠ½éå°±ä¸èƒ½å†æŠ½
      btn.onclick = () => draw(name);
      box.appendChild(btn);
    });
  }

  function draw(me) {
    if (records[me]) return;

    let available = remaining.filter(p => p !== me);
    if (available.length === 0) {
      document.getElementById("drawResult").innerText = "å·²ç¶“æ²’æœ‰å¯ä»¥æŠ½çš„äººäº†";
      return;
    }

    const chosen = available[Math.floor(Math.random() * available.length)];

    records[me] = chosen;
    remaining = remaining.filter(p => p !== chosen);

    document.getElementById("drawResult").innerText = `ğŸ‰ ${me} æŠ½åˆ°çš„æ˜¯ï¼š${chosen}`;
    document.getElementById("hideBtn").style.display = "block";

    renderButtons();
    updateRemain();
    saveData();
  }

  function hideResult() {
    document.getElementById("drawResult").innerText = "âœ… å·²æŠ½å®Œï¼ˆçµæœå·²éš±è—ï¼‰";
    document.getElementById("hideBtn").style.display = "none";
  }

  function updateRemain() {
    document.getElementById("remain").innerText = `å‰©é¤˜å¯è¢«æŠ½äººæ•¸ï¼š${remaining.length}`;
  }

  function query() {
    const name = document.getElementById("queryName").value.trim();
    if (records[name]) {
      document.getElementById("queryResult").innerText = `${name} æŠ½åˆ°çš„æ˜¯ï¼š${records[name]}`;
    } else {
      document.getElementById("queryResult").innerText = "æŸ¥ç„¡ç´€éŒ„";
    }
  }
</script>

</body>
</html>
